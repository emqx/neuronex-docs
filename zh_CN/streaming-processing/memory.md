# 内存源

<span style="background:green;color:white;">流</span>        <span style="background:green;color:white">扫描表</span>  <span style="background:green;color:white">查询表</span>

内存源通过主题消费由内存目标生成的事件。该主题类似于 pubsub 主题，例如 mqtt，因此可能有多个内存目标发布到同一主题，也可能有多个内存源订阅同一主题。 内存动作的典型用途是形成规则管道。内存动作和内存源之间的数据传输采用内部格式，不经过编解码以提高效率。因此，内存源的`format`属性会被忽略。

## 创建流

登录 NeuronEX，点击**数据流处理** -> **源管理**。在**流管理**页签，点击**创建流**。

在弹出的**源管理** / **创建**页面，进入如下配置：

- **流名称**：输入流名称
- **是否为带结构的流**：勾选确认是否为带结构的流，如为带结构的流，则需进一步添加流字段
  - **名称**：字段名称
  - **类型**：支持 bigint、float、string、datetime、boolean、array、struct、bytea
- **流类型**：选择 memory
- **数据源**（主题）：将要订阅的内存主题， 例如 topic1。类似 MQTT 主题
- **配置组**：可使用默认配置组，主题没有配置属性，由流数据源属性指定，但您可点击添加配置组按钮，输入名称名称，定义一个新的配置组。
- **流格式**：支持 json、binary、protobuf、delimited、custom。
  - 如选择 protobuf 或 custom，还应配置对应的[模式和模式消息](./config.md#模式)
  - 如选择 delimited，还应配置分隔符，如 ","

- **时间戳字段**：指定代表时间的字段。
- **时间戳格式**：指定时间戳格式。
- **共享**：勾选确认是否共享源。

您也可选择通过文本模式进行配置，通过 SQL 定义。

## 主题通配符

内存源也支持主题通配符，与 mqtt 主题类似。 目前，支持两种通配符。

**+** : 单级通配符替换一个主题等级。

**#**: 多级通配符涵盖多个主题级别，只能在结尾使用。

示例：

1. `home/device1/+/sensor1`
2. `home/device1/#`

## 创建扫描表

内存源支持查询表。登录 NeuronEX，点击**数据流处理** -> **源管理**。在**扫描表**页签，点击**创建扫描表**。

- **表名称**：输入表名称
- **是否为带结构的表**：勾选确认是否为带结构的表，如为带结构的表，则需进一步添加表字段
  - **名称**：字段名称
  - **类型**：支持 bigint、float、string、datetime、boolean、array、struct、bytea
- **表类型**：选择 memory
- **数据源**（主题）：将要订阅的内存主题， 例如 topic1。类似 MQTT 主题。
- **配置组**：可使用默认配置组，主题没有配置属性，由流数据源属性指定，但您可点击添加配置组按钮，输入名称名称，定义一个新的配置组。
- **表格式**：支持 json、binary、delimited、custom。
  - 如选择 custom，还应配置对应的[模式和模式消息](./config.md#模式)
  - 如选择 delimited，还应配置分隔符，如 ","

- **保留大小**：指定保留大小。

您也可选择通过文本模式进行配置，通过 SQL 定义。

## 创建查询表

内存源支持查询表。在创建一个内存查询表后，它将开始积累由键字段索引的内存主题的数据。它将一直独立于规则运行。每个主题和键对将有一个虚拟表的内存拷贝。所有引用同一表或具有相同主题/键对的内存表的规则将共享同一数据副本。它可以在内存中存储任何流类型的历史，以便其他流可以与之合作。

登录 NeuronEX，点击**数据流处理** -> **源管理**。在**查询表**页签，点击**创建查询表**。

- **表名称**：输入表名称
- **是否为带结构的表**：勾选确认是否为带结构的表，如为带结构的表，则需进一步添加表字段
  - **名称**：字段名称
  - **类型**：支持 bigint、float、string、datetime、boolean、array、struct、bytea
- **表类型**：选择 memory
- **数据源**（主题）：将要订阅的内存主题， 例如 topic1。类似 MQTT 主题。
- **配置组**：可使用默认配置组，主题没有配置属性，由流数据源属性指定，但您可点击添加配置组按钮，输入名称名称，定义一个新的配置组。
- **表格式**：支持 json、binary、delimited、custom。
  - 如选择 custom，还应配置对应的[模式和模式消息](./config.md#模式)
  - 如选择 delimited，还应配置分隔符，如 ","

- **主键**：指定主键。

您也可选择通过文本模式进行配置，通过 SQL 定义，例如：

```sql
CREATE TABLE alertTable() WITH (DATASOURCE="topicName", TYPE="memory", KIND="lookup", KEY="id")
```


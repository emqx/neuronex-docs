# 数据源

源（source）用于从外部系统中读取数据。数据源既可以是无界的流式数据，即流；也可以是有界的批量数据，即表。在规则中使用时，至少有一个源必须为流。源（source）获取数据后，还会根据定义的数据模型进行数据解码和转换。

关于数据加载机制，有两种模式：
- 扫描：像一个由事件驱动的流一样，一个一个地加载数据事件。这种模式的源可以用在流或扫描表中。
- 查找：在需要时引用外部内容，只用于查找表。

每个源将支持一种或两种模式。在源页面上，如果支持该模式，会有一个徽章显示。



## 数据源类型

目前 NeuronEX 内置以下数据源类型：

| 名称                        | 描述                                  | 流   | 扫描表 | 查询表 |
| --------------------------- | ---------------------------------- | ---- | ------ | ------ |
| [MQTT](./mqtt.md)           | 从 MQTT 主题读取数据                       | ✅    | ✅    | ❌    |
| [HTTP pull](./http_pull.md) | 从 HTTP 服务器中拉取数据                   | ✅    | ✅    | ❌    |
| [HTTP push](./http_push.md) | 通过 HTTP 推送数据到 NeuronEX              | ✅    | ✅   | ❌     |
| [内存](./memory.md)         | 从 NeuronEX 内存主题读取数据以形成规则管道 | ✅    | ✅      | ✅     |
| [Neuron](./neuron.md)       | 从NeuronEX的数采引擎模块读取数据           | ✅    | ✅      |❌    |
| [文件](./file.md)           | 从文件中读取数据                           | ✅    | ✅    | ❌    |
| [SQL](./sql.md)         | 从数据库中查询数据                        | ✅    | ✅      | ✅|
| [Video](./video.md)         | 从视频流中查询数据                        | ✅    | ✅   | ❌    |
| [Redis](./redis.md)         | 从 Redis 中查询数据                        | ❌    | ❌   | ✅   |

## 定义和运行

在 NeuronEX 中，定义数据源的流或者表之后，系统实际上只是创建了一个数据源的逻辑定义而非真正物理运行的数据输入。此逻辑定义可在多个规则的 SQL 的 `from` 子句中使用。只有当使用了该定义的规则启动之后，数据流才会真正运行。

默认情况下，多个规则使用同一个源的情况下，每个规则会启动一个独立的源的运行时，与其他规则中的同名源完全隔离。若多个规则需要使用完全相同的输入数据或者提高性能，源可定义为共享源，从而在多个规则中共享同一个实例。

## 解码

用户可以在创建源时通过指定流格式属性来定义解码方式。当前支持 `json`、 `binary`、`protobuf`、`delimited`，如希望使用自定义格式，也可以选择 `custom`。

## 数据结构

用户可以像定义关系数据库表结构一样定义数据源的结构。部分数据格式本身带有数据结构，例如 `protobuf` 格式。用户在创建源时可以定义 **模式名称** 来指向模式注册表 ( Schema Registry ) 中的数据结构定义。

其中，模式注册表中的定义为物理数据结构，而数据源定义语句中的数据结构为逻辑数据结构。若两者都有定义，则物理数据结构将覆盖逻辑数据结构。此时，数据结构的验证和格式化将有定义的格式负责，例如 `protobuf`。若只定义了逻辑结构而且设定了 `strictValidation`，NeuronEX 在运行时，会根据定义的结构进行数据验证和类型转换。若未设置验证，则逻辑数据结构主要用于编译和加载时的 SQL 语句验证。若输入数据为预处理过的干净数据或者数据结构未知或不固定，用户可不定义数据结构，从而也可以避免数据转换的开销。
